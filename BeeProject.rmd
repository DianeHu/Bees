---
title: "BeeProject"
author: "Diane Hu, Ashka Stephen, Jarod Cahoon"
date: "November 30, 2018"
output: html_document
---

```{r setup, message=F,include=F}
knitr::opts_chunk$set(echo = TRUE)
options(knitr.kable.NA = '')
```

```{r,include=FALSE}
library("tibble")
library("dplyr")
library("ggplot2")
library("broom")
library("knitr")
library("cowplot")
```

```{r}
honey <- read.csv("vHoneyNeonic_v02.csv")

honey <- na.omit(honey)
glimpse(honey)
```

```{r}
set.seed(7)

numObs <- summarize(honey, n = n())

honeySample <- sample_n(honey, as.integer(0.25*numObs))

glimpse(honeySample)
```

```{r}
# Numcol against everything for exp data analysis

ncYear <- ggplot(honeySample, aes(x = year, y = numcol)) + geom_point() + geom_line() + ggtitle("Number of Colonies vs Year")
ncCloth <- ggplot(honeySample, aes(x = nCLOTHIANIDIN, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs nCLOTHIANIDIN")
ncIMID <- ggplot(honeySample, aes(x = nIMIDACLOPRID, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs nIMIDACLOPRID")
ncTHIAM <- ggplot(honeySample, aes(x = nTHIAMETHOXAM, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs nTHIAMETHOXAM")
ncACET <- ggplot(honeySample, aes(x = nACETAMIPRID, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs nACETAMIPRID")
ncTHIAC <- ggplot(honeySample, aes(x = nACETAMIPRID, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs nTHIACLOPRID")
ncRegion <- ggplot(honeySample, aes(x = Region, y = numcol)) + geom_boxplot() + ggtitle("Number of colonies vs Region")
```

```{r}
ncYear
ncCloth
ncIMID
ncTHIAM
ncACET
ncTHIAC
ncRegion
```

```{r}
# Transformations

honeySample <- honeySample %>% mutate(logCloth = log(nCLOTHIANIDIN), logIMID = log(nIMIDACLOPRID), logTHIAM = log(nTHIAMETHOXAM),
                                      logACET = log(nACETAMIPRID), logTHIAC = log(nTHIACLOPRID))

ncLCloth <- ggplot(honeySample, aes(x = logCloth, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs Log nCLOTHIANIDIN")
ncLIMID <- ggplot(honeySample, aes(x = logIMID, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs Log nIMIDACLOPRID")
ncLTHIAM <- ggplot(honeySample, aes(x = logTHIAM, y = numcol)) + geom_point() + ggtitle("Number of Colonies Log vs nTHIAMETHOXAM")
ncLACET <- ggplot(honeySample, aes(x = logACET, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs Log nACETAMIPRID")
ncLTHIAC <- ggplot(honeySample, aes(x = logTHIAC, y = numcol)) + geom_point() + ggtitle("Number of Colonies vs Log nTHIACLOPRID")
```

```{r}
ncLCloth
ncLIMID
ncLTHIAM
ncLACET
ncLTHIAC
```

```{r}
nd <- honey %>% filter(StateName == "North Dakota")
nd <- nd %>% mutate(logCloth = log(nCLOTHIANIDIN), logIMID = log(nIMIDACLOPRID), logTHIAM = log(nTHIAMETHOXAM),
                                      logACET = log(nACETAMIPRID), logTHIAC = log(nTHIACLOPRID))
```

```{r}
ndYear <- ggplot(nd, aes(x = year, y = numcol)) + geom_point() + geom_line() + ggtitle("Number of ND Colonies vs Year")
ndLCloth <- ggplot(nd, aes(x = logCloth, y = numcol)) + geom_point() + ggtitle("Number of ND Colonies vs Log nCLOTHIANIDIN")
ndLIMID <- ggplot(nd, aes(x = logIMID, y = numcol)) + geom_point() + ggtitle("Number of ND Colonies vs Log nIMIDACLOPRID")
ndLTHIAM <- ggplot(nd, aes(x = logTHIAM, y = numcol)) + geom_point() + ggtitle("Number of ND Colonies Log vs nTHIAMETHOXAM")
ndLACET <- ggplot(nd, aes(x = logACET, y = numcol)) + geom_point() + ggtitle("Number of ND Colonies vs Log nACETAMIPRID")
ndLTHIAC <- ggplot(nd, aes(x = logTHIAC, y = numcol)) + geom_point() + ggtitle("Number of ND Colonies vs Log nTHIACLOPRID")
```

```{r}
ndYear
ndLCloth
ndLIMID
ndLTHIAM
ndLACET
ndLTHIAC
```

```{r}
cal <- honey %>% filter(StateName == "California")

cal = na.omit(cal)

glimpse(cal)
```

```{r}
cYear <- ggplot(cal, aes(x = year, y = numcol)) + geom_point() + geom_line() + ggtitle("Number of California Colonies vs Year")
cLCloth <- ggplot(cal, aes(x = logCloth, y = numcol)) + geom_point() + ggtitle("Number of California Colonies vs Log nCLOTHIANIDIN")
cLIMID <- ggplot(cal, aes(x = logIMID, y = numcol)) + geom_point() + ggtitle("Number of California Colonies vs Log nIMIDACLOPRID")
cLTHIAM <- ggplot(cal, aes(x = logTHIAM, y = numcol)) + geom_point() + ggtitle("Number of California Colonies Log vs nTHIAMETHOXAM")
cLACET <- ggplot(cal, aes(x = logACET, y = numcol)) + geom_point() + ggtitle("Number of California Colonies vs Log nACETAMIPRID")
cLTHIAC <- ggplot(cal, aes(x = logTHIAC, y = numcol)) + geom_point() + ggtitle("Number of California Colonies vs Log nTHIACLOPRID")
```

```{r}
cYear
cLCloth
cLIMID
cLTHIAM
cLACET
cLTHIAC
```

# Model

```{r}
glimpse(honeySample)
```

```{r}
honeySample$logCloth[which(!is.finite(honeySample$logCloth))] = NA
honeySample$logIMID[which(!is.finite(honeySample$logIMID))] = NA
honeySample$logTHIAM[which(!is.finite(honeySample$logTHIAM))] = NA
honeySample$logACET[which(!is.finite(honeySample$logACET))] = NA
honeySample$logTHIAC[which(!is.finite(honeySample$logTHIAC))] = NA

honeySample <- na.omit(honeySample)

numcolFull <- lm(numcol ~ Region + logCloth + logIMID + logTHIAM + logACET + logTHIAC,data=honeySample)
kable(tidy(numcolFull))
```

```{r}
library(olsrr)
reduced <- ols_step_forward_aic(numcolFull)
```

```{r}
baseModel <- lm(numcol ~ Region + logTHIAC + logTHIAM + logCloth, data=honeySample)
interactionsModel <- lm(numcol ~ Region + logTHIAC + logTHIAM + logCloth + Region*logCloth + Region*logTHIAM + Region*logTHIAC, data=honeySample)
kable(anova(baseModel, interactionsModel), format="html")
```

```{r}

```

?? Do we need to standardize year?

Yieldpercol ~ all pesticide types (not including nallNeonic) + year + state, and numcol ~ same values

1. oslr this

2. Do model without any of the pesticides, do a model with, anova

3. anova tests for all baseline models against models with one pesticide type included

4. interactions for all pesticide types between each other (anova this)

5. square and log transformations
